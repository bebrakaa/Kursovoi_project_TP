@model IEnumerable<InsuranceAgency.Domain.Entities.ContractApplication>
@{
    ViewData["Title"] = "–ó–∞—è–≤–∫–∏ –∫–ª–∏–µ–Ω—Ç–æ–≤";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<div class="d-flex justify-content-between align-items-center mb-4">
    <div>
        <h2>üìù –ó–∞—è–≤–∫–∏ –∫–ª–∏–µ–Ω—Ç–æ–≤ –Ω–∞ –¥–æ–≥–æ–≤–æ—Ä—ã</h2>
        <p class="text-muted mb-0">–û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞—è–≤–æ–∫ –æ—Ç –∫–ª–∏–µ–Ω—Ç–æ–≤ –Ω–∞ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ —Å—Ç—Ä–∞—Ö–æ–≤—ã—Ö –¥–æ–≥–æ–≤–æ—Ä–æ–≤. –û–¥–æ–±—Ä–µ–Ω–∏–µ –∏–ª–∏ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ –∑–∞—è–≤–æ–∫</p>
    </div>
    <a href="@Url.Action("Index", "Dashboard")" class="btn btn-outline-secondary">‚Üê –ù–∞–∑–∞–¥ –≤ –∫–∞–±–∏–Ω–µ—Ç</a>
</div>

<div class="mb-3">
    <form method="get" class="d-flex">
        <select name="status" class="form-select me-2">
            <option value="">–í—Å–µ —Å—Ç–∞—Ç—É—Å—ã</option>
            <option value="Pending">–û–∂–∏–¥–∞—é—Ç</option>
            <option value="Approved">–û–¥–æ–±—Ä–µ–Ω—ã</option>
            <option value="Rejected">–û—Ç–∫–ª–æ–Ω–µ–Ω—ã</option>
            <option value="Processed">–û–±—Ä–∞–±–æ—Ç–∞–Ω—ã</option>
        </select>
        <button type="submit" class="btn btn-primary">–§–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å</button>
    </form>
</div>

@if (Model != null && Model.Any())
{
    <div class="table-responsive">
        <table class="table table-striped table-hover">
            <thead class="table-dark">
                <tr>
                    <th>–ö–ª–∏–µ–Ω—Ç</th>
                    <th>–£—Å–ª—É–≥–∞ —Å—Ç—Ä–∞—Ö–æ–≤–∞–Ω–∏—è</th>
                    <th>–ü–µ—Ä–∏–æ–¥ –¥–µ–π—Å—Ç–≤–∏—è</th>
                    <th>–ñ–µ–ª–∞–µ–º–∞—è –ø—Ä–µ–º–∏—è</th>
                    <th>–°—Ç–∞—Ç—É—Å –∑–∞—è–≤–∫–∏</th>
                    <th>–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è</th>
                    <th class="text-center">–î–µ–π—Å—Ç–≤–∏—è</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var application in Model)
                {
                    <tr>
                        <td><strong>@(application.Client?.FullName ?? "<span class='text-muted'>–ö–ª–∏–µ–Ω—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω</span>")</strong></td>
                        <td>@(application.Service?.Name ?? "<span class='text-muted'>–£—Å–ª—É–≥–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞</span>")</td>
                        <td>@application.DesiredStartDate.ToString("dd.MM.yyyy") - @application.DesiredEndDate.ToString("dd.MM.yyyy")</td>
                        <td><span class="badge bg-info">@application.DesiredPremium.ToString("N2") RUB</span></td>
                        <td>
                            @if (application.Status == InsuranceAgency.Domain.Enums.ApplicationStatus.Approved)
                            {
                                <span class="badge bg-success">‚úÖ –û–¥–æ–±—Ä–µ–Ω–∞</span>
                            }
                            else if (application.Status == InsuranceAgency.Domain.Enums.ApplicationStatus.Rejected)
                            {
                                <span class="badge bg-danger">‚ùå –û—Ç–∫–ª–æ–Ω–µ–Ω–∞</span>
                            }
                            else if (application.Status == InsuranceAgency.Domain.Enums.ApplicationStatus.Processed)
                            {
                                <span class="badge bg-primary">‚úÖ –û–±—Ä–∞–±–æ—Ç–∞–Ω–∞</span>
                            }
                            else
                            {
                                <span class="badge bg-warning">‚è≥ –û–∂–∏–¥–∞–µ—Ç —Ä–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∏—è</span>
                            }
                        </td>
                        <td>@application.CreatedAt.ToString("dd.MM.yyyy HH:mm")</td>
                        <td class="text-center">
                            @if (application.Status == InsuranceAgency.Domain.Enums.ApplicationStatus.Pending)
                            {
                                <form method="post" asp-action="ApproveApplication" asp-controller="Agent" asp-route-id="@application.Id" asp-antiforgery="true" class="d-inline">
                                    <button type="submit" class="btn btn-sm btn-success me-1" title="–û–¥–æ–±—Ä–∏—Ç—å –∑–∞—è–≤–∫—É">
                                        ‚úÖ –û–¥–æ–±—Ä–∏—Ç—å
                                    </button>
                                </form>
                                <button type="button" class="btn btn-sm btn-danger" data-bs-toggle="modal" data-bs-target="#rejectModal@(application.Id)" title="–û—Ç–∫–ª–æ–Ω–∏—Ç—å –∑–∞—è–≤–∫—É">
                                    ‚ùå –û—Ç–∫–ª–æ–Ω–∏—Ç—å
                                </button>
                                
                                <!-- Modal –¥–ª—è –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏—è -->
                                <div class="modal fade" id="rejectModal@(application.Id)" tabindex="-1">
                                    <div class="modal-dialog">
                                        <div class="modal-content">
                                            <div class="modal-header">
                                                <h5 class="modal-title">–û—Ç–∫–ª–æ–Ω–∏—Ç—å –∑–∞—è–≤–∫—É</h5>
                                                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                                            </div>
                                            <form method="post" asp-action="RejectApplication" asp-controller="Agent" asp-route-id="@application.Id" asp-antiforgery="true">
                                                <div class="modal-body">
                                                    <div class="mb-3">
                                                        <label class="form-label">–ü—Ä–∏—á–∏–Ω–∞ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏—è <span class="text-danger">*</span></label>
                                                        <textarea name="reason" class="form-control" rows="3" required placeholder="–£–∫–∞–∂–∏—Ç–µ –ø—Ä–∏—á–∏–Ω—É –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏—è –∑–∞—è–≤–∫–∏..."></textarea>
                                                        <small class="form-text text-muted">–≠—Ç–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –±—É–¥–µ—Ç –≤–∏–¥–Ω–∞ –∫–ª–∏–µ–Ω—Ç—É</small>
                                                    </div>
                                                </div>
                                                <div class="modal-footer">
                                                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">–û—Ç–º–µ–Ω–∞</button>
                                                    <button type="submit" class="btn btn-danger">–û—Ç–∫–ª–æ–Ω–∏—Ç—å –∑–∞—è–≤–∫—É</button>
                                                </div>
                                            </form>
                                        </div>
                                    </div>
                                </div>
                            }
                            else
                            {
                                <span class="text-muted">-</span>
                            }
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
}
else
{
    <div class="alert alert-info">
        <h5>üìã –ó–∞—è–≤–æ–∫ –ø–æ–∫–∞ –Ω–µ—Ç</h5>
        <p class="mb-0">–ö–ª–∏–µ–Ω—Ç—ã –µ—â–µ –Ω–µ —Å–æ–∑–¥–∞–≤–∞–ª–∏ –∑–∞—è–≤–æ–∫ –Ω–∞ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ —Å—Ç—Ä–∞—Ö–æ–≤—ã—Ö –¥–æ–≥–æ–≤–æ—Ä–æ–≤</p>
    </div>
}

