@{
    ViewData["Title"] = "–û–ø–ª–∞—Ç–∞ –¥–æ–≥–æ–≤–æ—Ä–∞";
    Layout = "~/Views/Shared/_Layout.cshtml";
    var contract = ViewBag.Contract as InsuranceAgency.Domain.Entities.Contract;
}

<h2>–û–ø–ª–∞—Ç–∞ –¥–æ–≥–æ–≤–æ—Ä–∞</h2>

@if (ViewBag.Error != null)
{
    <div class="alert alert-danger">@ViewBag.Error</div>
}

@if (contract != null)
{
    <div class="row">
        <div class="col-md-8">
            <div class="card shadow-sm mb-4">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0">üìÑ –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –¥–æ–≥–æ–≤–æ—Ä–µ</h5>
                </div>
                <div class="card-body">
                    <dl class="row">
                        <dt class="col-sm-4">–ù–æ–º–µ—Ä –¥–æ–≥–æ–≤–æ—Ä–∞:</dt>
                        <dd class="col-sm-8">
                            @if (string.IsNullOrWhiteSpace(contract.Number))
                            {
                                <span class="text-muted">–ù–µ –ø—Ä–∏—Å–≤–æ–µ–Ω</span>
                            }
                            else
                            {
                                <strong>@contract.Number</strong>
                            }
                        </dd>
                        <dt class="col-sm-4">–£—Å–ª—É–≥–∞ —Å—Ç—Ä–∞—Ö–æ–≤–∞–Ω–∏—è:</dt>
                        <dd class="col-sm-8">@(contract.Service?.Name ?? "<span class='text-muted'>–£—Å–ª—É–≥–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞</span>")</dd>
                        <dt class="col-sm-4">–ü–µ—Ä–∏–æ–¥ –¥–µ–π—Å—Ç–≤–∏—è:</dt>
                        <dd class="col-sm-8">@contract.StartDate.ToString("dd.MM.yyyy") - @contract.EndDate.ToString("dd.MM.yyyy")</dd>
                        <dt class="col-sm-4">–°—É–º–º–∞ –∫ –æ–ø–ª–∞—Ç–µ:</dt>
                        <dd class="col-sm-8"><strong class="text-success" style="font-size: 1.2rem;">@contract.Premium.Amount.ToString("N2") @contract.Premium.Currency</strong></dd>
                    </dl>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card shadow-sm">
                <div class="card-header bg-info text-white">
                    <h5 class="mb-0">‚ÑπÔ∏è –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h5>
                </div>
                <div class="card-body">
                    <p class="small mb-2"><strong>–°—Ç–∞—Ç—É—Å –¥–æ–≥–æ–≤–æ—Ä–∞:</strong></p>
                    <p>
                        @{
                            var statusClass = contract.Status switch
                            {
                                InsuranceAgency.Domain.Enums.ContractStatus.Registered => "bg-info",
                                InsuranceAgency.Domain.Enums.ContractStatus.PendingPayment => "bg-warning",
                                InsuranceAgency.Domain.Enums.ContractStatus.Paid => "bg-primary",
                                InsuranceAgency.Domain.Enums.ContractStatus.Active => "bg-success",
                                InsuranceAgency.Domain.Enums.ContractStatus.Overdue => "bg-danger",
                                InsuranceAgency.Domain.Enums.ContractStatus.Suspended => "bg-warning",
                                InsuranceAgency.Domain.Enums.ContractStatus.Cancelled => "bg-dark",
                                InsuranceAgency.Domain.Enums.ContractStatus.Problematic => "bg-danger",
                                InsuranceAgency.Domain.Enums.ContractStatus.Expired => "bg-secondary",
                                InsuranceAgency.Domain.Enums.ContractStatus.Completed => "bg-success",
                                _ => "bg-secondary"
                            };
                            var statusText = contract.Status switch
                            {
                                InsuranceAgency.Domain.Enums.ContractStatus.Registered => "–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω",
                                InsuranceAgency.Domain.Enums.ContractStatus.PendingPayment => "–û–∂–∏–¥–∞–Ω–∏–µ –æ–ø–ª–∞—Ç—ã",
                                InsuranceAgency.Domain.Enums.ContractStatus.Paid => "–û–ø–ª–∞—á–µ–Ω",
                                InsuranceAgency.Domain.Enums.ContractStatus.Active => "–ê–∫—Ç–∏–≤–µ–Ω",
                                InsuranceAgency.Domain.Enums.ContractStatus.Overdue => "–ü—Ä–æ—Å—Ä–æ—á–µ–Ω",
                                InsuranceAgency.Domain.Enums.ContractStatus.Suspended => "–ü—Ä–∏–æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω",
                                InsuranceAgency.Domain.Enums.ContractStatus.Cancelled => "–û—Ç–º–µ–Ω—ë–Ω",
                                InsuranceAgency.Domain.Enums.ContractStatus.Problematic => "–ü—Ä–æ–±–ª–µ–º–Ω—ã–π",
                                InsuranceAgency.Domain.Enums.ContractStatus.Expired => "–ò—Å—Ç—ë–∫ —Å—Ä–æ–∫",
                                InsuranceAgency.Domain.Enums.ContractStatus.Completed => "–ó–∞–≤–µ—Ä—à—ë–Ω",
                                _ => "–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ"
                            };
                        }
                        <span class="badge @statusClass">@statusText</span>
                    </p>
                    <hr>
                    <p class="small mb-0 text-muted">–ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –æ–ø–ª–∞—Ç—ã –¥–æ–≥–æ–≤–æ—Ä –±—É–¥–µ—Ç –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏</p>
                </div>
            </div>
        </div>
    </div>

    <div class="card shadow-sm">
        <div class="card-header bg-success text-white">
            <h5 class="mb-0">üí≥ –û–ø–ª–∞—Ç–∞ –¥–æ–≥–æ–≤–æ—Ä–∞</h5>
        </div>
        <div class="card-body">
            <form method="post" asp-action="ProcessPayment" asp-controller="Client" asp-route-contractId="@contract.Id" asp-antiforgery="true">
                <div class="alert alert-info">
                    <strong>‚ÑπÔ∏è –í–Ω–∏–º–∞–Ω–∏–µ!</strong> –ü–ª–∞—Ç–µ–∂–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –∫–∞–∫ –∑–∞–≥–ª—É—à–∫–∞ –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏. –ü–ª–∞—Ç–µ–∂ –±—É–¥–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω.
                </div>
                <div class="text-center mb-3">
                    <h4 class="text-primary">–ö –æ–ø–ª–∞—Ç–µ: <strong>@contract.Premium.Amount.ToString("N2") @contract.Premium.Currency</strong></h4>
                </div>
                <button type="submit" class="btn btn-success btn-lg w-100">
                    üí≥ –û–ø–ª–∞—Ç–∏—Ç—å –¥–æ–≥–æ–≤–æ—Ä
                </button>
            </form>
        </div>
    </div>
}
else
{
    <div class="alert alert-danger">
        <h5>‚ùå –î–æ–≥–æ–≤–æ—Ä –Ω–µ –Ω–∞–π–¥–µ–Ω</h5>
        <p class="mb-0">–ó–∞–ø—Ä–æ—à–µ–Ω–Ω—ã–π –¥–æ–≥–æ–≤–æ—Ä –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –∏–ª–∏ –±—ã–ª —É–¥–∞–ª–µ–Ω. <a href="@Url.Action("History", "Client")">–í–µ—Ä–Ω—É—Ç—å—Å—è –∫ –∏—Å—Ç–æ—Ä–∏–∏</a></p>
    </div>
}

