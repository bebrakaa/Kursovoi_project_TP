@model InsuranceAgency.Domain.Entities.User
@{
    ViewData["Title"] = "–ú–æ–π –ø—Ä–æ—Ñ–∏–ª—å";
    Layout = "~/Views/Shared/_Layout.cshtml";
    var client = ViewBag.Client as InsuranceAgency.Domain.Entities.Client;
}

<div class="d-flex justify-content-between align-items-center mb-4">
    <div>
        <h2>üë§ –ú–æ–π –ø—Ä–æ—Ñ–∏–ª—å</h2>
        <p class="text-muted mb-0">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ª–∏—á–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏ –∞–∫–∫–∞—É–Ω—Ç–∞</p>
    </div>
    <div>
        <a href="@Url.Action("Index", "Dashboard")" class="btn btn-outline-secondary">‚Üê –ù–∞–∑–∞–¥ –≤ –∫–∞–±–∏–Ω–µ—Ç</a>
        <a href="@Url.Action("Index", "Home")" class="btn btn-outline-primary ms-2">üè† –ù–∞ –≥–ª–∞–≤–Ω—É—é</a>
    </div>
</div>

<div class="row mt-4">
    <div class="col-md-8">
        <div class="card shadow-sm">
            <div class="card-header">
                <h5>–õ–∏—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ</h5>
            </div>
            <div class="card-body">
                <dl class="row">
                    <dt class="col-sm-4">–õ–æ–≥–∏–Ω:</dt>
                    <dd class="col-sm-8">@Model.Username</dd>
                    
                    <dt class="col-sm-4">Email:</dt>
                    <dd class="col-sm-8">@Model.Email</dd>
                    
                    <dt class="col-sm-4">–†–æ–ª—å:</dt>
                    <dd class="col-sm-8"><span class="badge bg-success">@Model.Role</span></dd>
                    
                    @if (client != null)
                    {
                        <dt class="col-sm-4">–§–ò–û:</dt>
                        <dd class="col-sm-8">
                            @if (string.IsNullOrWhiteSpace(client.FullName))
                            {
                                <span class="text-muted">–ù–µ —É–∫–∞–∑–∞–Ω–æ</span>
                            }
                            else
                            {
                                @client.FullName
                            }
                        </dd>
                        
                        <dt class="col-sm-4">–¢–µ–ª–µ—Ñ–æ–Ω:</dt>
                        <dd class="col-sm-8">
                            @if (string.IsNullOrWhiteSpace(client.Phone))
                            {
                                <span class="text-muted">–ù–µ —É–∫–∞–∑–∞–Ω</span>
                            }
                            else
                            {
                                @client.Phone
                            }
                        </dd>
                        
                        <dt class="col-sm-4">–ü–∞—Å–ø–æ—Ä—Ç:</dt>
                        <dd class="col-sm-8">
                            @if (string.IsNullOrWhiteSpace(client.Passport))
                            {
                                <span class="text-muted">–ù–µ —É–∫–∞–∑–∞–Ω</span>
                            }
                            else
                            {
                                @client.Passport
                            }
                        </dd>
                    }
                </dl>
                
                <div class="mt-3">
                    <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#editModal">‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Modal –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è -->
<div class="modal fade" id="editModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ—Ñ–∏–ª—å</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <form method="post" asp-action="UpdateProfile" asp-antiforgery="true">
                <div class="modal-body">
                    <div class="mb-3">
                        <label class="form-label">Email <span class="text-danger">*</span></label>
                        <input type="email" name="Email" class="form-control" value="@Model.Email" required />
                        @if (!ViewData.ModelState.IsValid && ViewData.ModelState["Email"] != null)
                        {
                            <span class="text-danger">@ViewData.ModelState["Email"]?.Errors.FirstOrDefault()?.ErrorMessage</span>
                        }
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label">–§–ò–û</label>
                        <input type="text" name="FullName" class="form-control" value="@(client?.FullName ?? "")" placeholder="–ò–≤–∞–Ω–æ–≤ –ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤–∏—á" />
                        @if (!ViewData.ModelState.IsValid && ViewData.ModelState["FullName"] != null)
                        {
                            <span class="text-danger">@ViewData.ModelState["FullName"]?.Errors.FirstOrDefault()?.ErrorMessage</span>
                        }
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label">–¢–µ–ª–µ—Ñ–æ–Ω</label>
                        <input type="tel" name="Phone" class="form-control" value="@(client?.Phone ?? "")" placeholder="+7 (999) 123-45-67" />
                        @if (!ViewData.ModelState.IsValid && ViewData.ModelState["Phone"] != null)
                        {
                            <span class="text-danger">@ViewData.ModelState["Phone"]?.Errors.FirstOrDefault()?.ErrorMessage</span>
                        }
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label">–ü–∞—Å–ø–æ—Ä—Ç</label>
                        <input type="text" name="Passport" class="form-control" value="@(client?.Passport ?? "")" placeholder="1234 567890" />
                        @if (!ViewData.ModelState.IsValid && ViewData.ModelState["Passport"] != null)
                        {
                            <span class="text-danger">@ViewData.ModelState["Passport"]?.Errors.FirstOrDefault()?.ErrorMessage</span>
                        }
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">–û—Ç–º–µ–Ω–∞</button>
                    <button type="submit" class="btn btn-primary">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                </div>
            </form>
        </div>
    </div>
</div>
