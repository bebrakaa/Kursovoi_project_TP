@model InsuranceAgency.Application.DTOs.ContractApplication.CreateApplicationDto
@{
    ViewData["Title"] = "–°–æ–∑–¥–∞—Ç—å –∑–∞—è–≤–∫—É –Ω–∞ –¥–æ–≥–æ–≤–æ—Ä";
    Layout = "~/Views/Shared/_Layout.cshtml";
    var services = ViewBag.Services as IEnumerable<InsuranceAgency.Domain.Entities.InsuranceService>;
}

<div class="d-flex justify-content-between align-items-center mb-4">
    <div>
        <h2>üìù –°–æ–∑–¥–∞—Ç—å –∑–∞—è–≤–∫—É –Ω–∞ —Å—Ç—Ä–∞—Ö–æ–≤–æ–π –¥–æ–≥–æ–≤–æ—Ä</h2>
        <p class="text-muted mb-0">–ó–∞–ø–æ–ª–Ω–∏—Ç–µ —Ñ–æ—Ä–º—É –¥–ª—è –ø–æ–¥–∞—á–∏ –∑–∞—è–≤–∫–∏ –Ω–∞ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ —Å—Ç—Ä–∞—Ö–æ–≤–æ–≥–æ –¥–æ–≥–æ–≤–æ—Ä–∞. –ü–æ—Å–ª–µ –ø–æ–¥–∞—á–∏ –∑–∞—è–≤–∫–∞ –±—É–¥–µ—Ç —Ä–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∞ –∞–≥–µ–Ω—Ç–æ–º</p>
    </div>
    <a href="@Url.Action("MyApplications", "Client")" class="btn btn-outline-secondary">‚Üê –ú–æ–∏ –∑–∞—è–≤–∫–∏</a>
</div>

@if (!ViewData.ModelState.IsValid)
{
    <div class="alert alert-danger">
        <ul class="mb-0">
            @foreach (var error in ViewData.ModelState.Values.SelectMany(v => v.Errors))
            {
                <li>@error.ErrorMessage</li>
            }
        </ul>
    </div>
}

<form method="post" asp-antiforgery="true" class="mt-4">
    <div class="row">
        <div class="col-md-6 mb-3">
            <label asp-for="ServiceId" class="form-label">–£—Å–ª—É–≥–∞</label>
            <select asp-for="ServiceId" class="form-select">
                <option value="">–í—ã–±–µ—Ä–∏—Ç–µ —É—Å–ª—É–≥—É</option>
                @foreach (var service in services ?? Enumerable.Empty<InsuranceAgency.Domain.Entities.InsuranceService>())
                {
                    <option value="@service.Id" data-premium="@service.DefaultPremium.Amount">@service.Name - @service.DefaultPremium.Amount @service.DefaultPremium.Currency</option>
                }
            </select>
            <span asp-validation-for="ServiceId" class="text-danger"></span>
        </div>
        <div class="col-md-6 mb-3">
            <label asp-for="DesiredPremium" class="form-label">–ü—Ä–µ–º–∏—è</label>
            <input asp-for="DesiredPremium" class="form-control" step="0.01" />
            <small class="form-text text-muted">–ë—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∞ –ø—Ä–µ–º–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é, –µ—Å–ª–∏ –Ω–µ —É–∫–∞–∑–∞–Ω–∞</small>
            <span asp-validation-for="DesiredPremium" class="text-danger"></span>
        </div>
    </div>
    <div class="row">
        <div class="col-md-6 mb-3">
            <label asp-for="DesiredStartDate" class="form-label">–î–∞—Ç–∞ –Ω–∞—á–∞–ª–∞</label>
            <input asp-for="DesiredStartDate" class="form-control" type="date" />
            <span asp-validation-for="DesiredStartDate" class="text-danger"></span>
        </div>
        <div class="col-md-6 mb-3">
            <label asp-for="DesiredEndDate" class="form-label">–î–∞—Ç–∞ –æ–∫–æ–Ω—á–∞–Ω–∏—è</label>
            <input asp-for="DesiredEndDate" class="form-control" type="date" />
            <span asp-validation-for="DesiredEndDate" class="text-danger"></span>
        </div>
    </div>
    <div class="mb-3">
        <label asp-for="Notes" class="form-label">–ü—Ä–∏–º–µ—á–∞–Ω–∏—è</label>
        <textarea asp-for="Notes" class="form-control" rows="3"></textarea>
        <span asp-validation-for="Notes" class="text-danger"></span>
    </div>
    <div class="mb-3">
        <button type="submit" class="btn btn-primary">–ü–æ–¥–∞—Ç—å –∑–∞—è–≤–∫—É</button>
        <a href="@Url.Action("Index", "Dashboard")" class="btn btn-secondary">–û—Ç–º–µ–Ω–∞</a>
    </div>
</form>

@section Scripts {
    @{await Html.RenderPartialAsync("_ValidationScriptsPartial");}
    <script>
    document.addEventListener('DOMContentLoaded', function() {
        const serviceSelect = document.querySelector('select[name="ServiceId"]');
        const premiumInput = document.querySelector('input[name="DesiredPremium"]');
        const startDateInput = document.querySelector('input[name="DesiredStartDate"]');
        const endDateInput = document.querySelector('input[name="DesiredEndDate"]');
        
        if (startDateInput && endDateInput) {
            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –º–∏–Ω–∏–º–∞–ª—å–Ω—É—é –¥–∞—Ç—É –Ω–∞ —Å–µ–≥–æ–¥–Ω—è
            const today = new Date().toISOString().split('T')[0];
            startDateInput.min = today;
            endDateInput.min = today;
            
            // –ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –¥–∞—Ç—ã –Ω–∞—á–∞–ª–∞, –æ–±–Ω–æ–≤–ª—è–µ–º –º–∏–Ω–∏–º–∞–ª—å–Ω—É—é –¥–∞—Ç—É –æ–∫–æ–Ω—á–∞–Ω–∏—è
            startDateInput.addEventListener('change', function() {
                endDateInput.min = this.value;
            });
        }
        
        // –ü—Ä–∏ –≤—ã–±–æ—Ä–µ —É—Å–ª—É–≥–∏, —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø—Ä–µ–º–∏—é –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
        if (serviceSelect && premiumInput) {
            serviceSelect.addEventListener('change', function() {
                const selectedOption = this.options[this.selectedIndex];
                const premium = selectedOption.getAttribute('data-premium');
                if (premium) {
                    premiumInput.value = premium;
                }
            });
        }
    });
    </script>
}

